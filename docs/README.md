# Load Balancer

Простой балансировщик нагрузки на Go, который распределяет HTTP-запросы между несколькими бэкенд-серверами с использованием алгоритма Round-Robin и включает ограничение частоты запросов (rate limiting) с помощью алгоритма Token Bucket.

## Возможности

#### Балансировщик нагрузки
- Балансировка нагрузки с использованием алгоритма Round-Robin, least connections, random
- Балансировщик корректно обрабатывает ситуацию, когда один или несколько бэкендов недоступны
- Обеспечивается одновременная обработка нескольких запросов с использованием горутин
- Гарантирована корректная работа в условиях конкурентных вызовов (избегать гонок данных)
- Реализована обработка ошибок, вывод понятных сообщений в лог
- Конфигурация через JSON-файл
- Алгоритм покрыт интеграционными тестами
- Логирование событий

#### Rate-Limiting
- Ограничение частоты запросов (rate limiting) с использованием алгоритма Token Bucket
- Каждому (IP или API-ключ) выделяется отдельный bucket токенов
- Настройки bucket: количество токенов (емкость), скорость пополнения
- Запрос считается допустимым, если в bucket клиента есть токен. В противном случае — отклоняется
- Отслеживание состояния каждого клиента (IP/API-ключ)
- Гарантирована атомарность операций с токенами (проверка, извлечение, пополнение)
- Методы обработки запросов и обновления состояния buckets потокобезопасные

#### Health Checks
- Проверка доступности бэкенд-серверов
- Механизм периодических проверок состояния каждого бэкенд-сервера.
- При обнаружении недоступного сервера временно исключает его из пула, а при восстановлении работы возвращает обратно.

#### Прочее
- Graceful Shutdown: корректное завершение работы (обработка сигнала SIGINT или SIGTERM)
- Архитектура проекта модульная
- Использован конфигурационный файл для дефолтных лимитов

## Установка

```bash
git clone https://github.com/Roman-Samoilenko/http-load-balancer.git
cd http-load-balancer
go build -o http-load-balancer ./cmd/server
```

## Конфигурация
Конфигурация приложения осуществляется через файл `configs/config.json`:

```json
{
  "server": {
    "port": 8080
  },
  "balancer_type": "round-robin",
  "backends": [
    {
      "url": "http://localhost:8081",
      "weight": 1,
      "max_connections": 100
    },
    {
      "url": "http://localhost:8082",
      "weight": 1,
      "max_connections": 100
    }
  ],
  "rate_limit": {
    "enabled": true,
    "default_rate": 10,
    "default_capacity": 100
  },
  "health_check": {
    "interval": 10,
    "timeout": 2
  }
}
```

### Параметры конфигурации
- `server.port` - порт, на котором будет работать балансировщик
- `balancer_type` - алгоритм балансировки (Round-Robin, least connections, random)
- `backends.weight` - вес бэкенда для алгоритмов балансировки нагрузки

#### Rate limit:
- `default_rate` - скорость пополнения токенов для пользователя
- `default_capacity` - максимальный запас токенов для пользователя

#### Health Check:
- `interval` - временные промежутки проверки доступности бэкенда
- `timeout` - предельное время ожидания ответа


## TODO
* [x] Реализовать алгоритм random.
* [ ] Подключить БД и написать CRUD для хранения состояний клиентов.
* [x] Написать Dockerfile и docker-compose.yml для развертывания сервиса.
